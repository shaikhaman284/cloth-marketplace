{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Dashboard - {{ site_title }}{% endblock %}

{% block content %}
<h1>Platform Dashboard</h1>

<style>
    .dashboard-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }
    .stat-card {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .stat-card h3 {
        margin: 0 0 10px 0;
        color: #666;
        font-size: 14px;
        text-transform: uppercase;
    }
    .stat-card .value {
        font-size: 32px;
        font-weight: bold;
        color: #333;
    }
    .stat-card.revenue {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    .stat-card.revenue h3,
    .stat-card.revenue .value {
        color: white;
    }
    .recent-orders {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
    }
    .recent-orders table {
        width: 100%;
        border-collapse: collapse;
    }
    .recent-orders th,
    .recent-orders td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #eee;
    }
    .badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        color: white;
    }
    .badge-placed { background: orange; }
    .badge-confirmed { background: blue; }
    .badge-delivered { background: green; }
</style>

<div class="dashboard-container">
    <!-- Revenue Stats -->
    <div class="stat-card revenue">
        <h3>Total Platform Revenue</h3>
        <div class="value">₹{{ platform_revenue }}</div>
        <small>Commission + COD Fees</small>
    </div>
    
    <div class="stat-card">
        <h3>Total GMV</h3>
        <div class="value">₹{{ total_gmv }}</div>
        <small>Gross Merchandise Value</small>
    </div>
    
    <div class="stat-card">
        <h3>Total Commission</h3>
        <div class="value">₹{{ total_commission }}</div>
        <small>From {{ total_orders }} orders</small>
    </div>
    
    <div class="stat-card">
        <h3>Seller Payouts</h3>
        <div class="value">₹{{ total_seller_payouts }}</div>
        <small>Paid to sellers</small>
    </div>
    
    <!-- Order Stats -->
    <div class="stat-card">
        <h3>Total Orders</h3>
        <div class="value">{{ total_orders }}</div>
        <small>All time</small>
    </div>
    
    <div class="stat-card">
        <h3>Today's Orders</h3>
        <div class="value">{{ today_orders }}</div>
        <small>Revenue: ₹{{ today_revenue }}</small>
    </div>
    
    <div class="stat-card">
        <h3>This Week</h3>
        <div class="value">{{ week_orders }}</div>
        <small>Revenue: ₹{{ week_revenue }}</small>
    </div>
    
    <div class="stat-card">
        <h3>This Month</h3>
        <div class="value">{{ month_orders }}</div>
        <small>Revenue: ₹{{ month_revenue }}</small>
    </div>
    
    <!-- User Stats -->
    <div class="stat-card">
        <h3>Total Shops</h3>
        <div class="value">{{ total_shops }}</div>
        <small>{{ approved_shops }} approved, {{ pending_shops }} pending</small>
    </div>
    
    <div class="stat-card">
        <h3>Total Sellers</h3>
        <div class="value">{{ total_sellers }}</div>
    </div>
    
    <div class="stat-card">
        <h3>Total Customers</h3>
        <div class="value">{{ total_customers }}</div>
    </div>
    
    <div class="stat-card">
        <h3>Active Products</h3>
        <div class="value">{{ active_products }}</div>
        <small>{{ total_products }} total</small>
    </div>
</div>

<!-- Recent Orders -->
<div class="recent-orders">
    <h2>Recent Orders</h2>
    <table>
        <thead>
            <tr>
                <th>Order #</th>
                <th>Customer</th>
                <th>Shop</th>
                <th>Amount</th>
                <th>Commission</th>
                <th>Status</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody>
            {% for order in recent_orders %}
            <tr>
                <td><a href="{% url 'admin:orders_order_change' order.id %}">{{ order.order_number }}</a></td>
                <td>{{ order.customer.full_name }}</td>
                <td>{{ order.shop.shop_name }}</td>
                <td>₹{{ order.total_amount }}</td>
                <td>₹{{ order.commission_amount }}</td>
                <td>
                    <span class="badge badge-{{ order.order_status }}">
                        {{ order.get_order_status_display }}
                    </span>
                </td>
                <td>{{ order.placed_at|date:"d M Y, h:i A" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}